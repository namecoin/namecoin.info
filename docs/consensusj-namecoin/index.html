<!DOCTYPE html>
<html class="nojs">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ConsensusJ-Namecoin</title>
    <!--<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">-->

    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <link href="/css/style.css" rel="stylesheet">
    
    <link rel="canonical" href="https://www.namecoin.org//docs/consensusj-namecoin/">
    <link rel="alternate" type="application/rss+xml" title="Namecoin News" href="/feed.rss"/>

    <link rel="icon" href='/images/namecoin-coin_100px.png' sizes="100x100" type="image/png">
    <link rel="icon" href='/images/namecoin-coin_200px.png' sizes="200x200" type="image/png">
    <link rel="icon" href='/images/namecoin-coin.svg' sizes="any" type="image/svg+xml">
</head>


  <body>

    <header class="site-header">

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="/"><img src="/images/logo.png" alt="Namecoin" /></a>
                </div>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse" tabindex="">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-collapse collapse" id="navbar-collapse">
                <ul class="nav navbar-nav navbar-left">
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Get Started</a>
                        <ul class="dropdown-menu">
                            <li><a href="/download/">Download</a></li>
                            <li><a href="/get-started/name-wallets/">Name Wallets</a></li>
                            <li><a href="/get-started/get-namecoins/">Get Namecoins</a></li>
                            <li><a href="/docs/name-owners/">Docs for Domain Owners</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Dot-Bit</a>
                        <ul class="dropdown-menu">
                            <li><a href="/dot-bit/">Home</a></li>
                            <li><a href="/dot-bit/browsing-instructions/">Browsing Instructions</a></li>
                            <li><a href="/dot-bit/security-model/">Security Model</a></li>
                        </ul>
                    </li>
                    <li><a href="/docs/faq/">FAQ</a></li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Resources</a>
                        <ul class="dropdown-menu">
                            <li><a href="/resources/chat/">Matrix/IRC Chat</a></li>
                            <li><a href="https://forum.namecoin.org">Forum&#10138;</a></li>
                            <li><a href="/resources/presentations/">Presentations</a></li>
                            <li><a href="/explorers/">Explorers</a></li>
                            <li><a href="https://github.com/namecoin/meta/blob/master/roadmap.md">Roadmap&#10138;</a></li>
                        </ul>
                    </li>
                    <li><a href="/team/">Team</a></li>
                    <li><a href="/news/">News</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="/contribute/">Contribute</a></li>
                </ul>
                </div>
            </div>
        </nav>

</header>

<div id="fancy-graphic"><div class="container-fluid"><p id="tagline">
<noscript>

<strong>Against<br />censorship.</strong>
</noscript>

    <span class="candidate-tagline" hidden>
        <strong>In information</strong><br />we <strong>trust</strong>.
    </span>

    <span class="candidate-tagline" hidden>
        A <strong>trust anchor</strong><br />for the Internet.
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Against<br />censorship.</strong>
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Supporting<br />free speech.</strong>
    </span>

    <span class="candidate-tagline" hidden>
        Decentralized<br /><strong>secure</strong> names.
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Decentralize</strong><br>all the things!
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Freedom</strong><br>of information.
    </span>

</p></div></div>


    <div id="content">
      <div class="container-fluid">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">ConsensusJ-Namecoin</h1>
  </header>

  <article class="post-content">
    
<p>This is documentation for ConsensusJ-Namecoin (a lightweight SPV Namecoin name lookup client).  It is based on the following pre-existing projects:</p>

<ul>
  <li>libdohj by Ross Nicoll</li>
  <li>ConsensusJ by Sean Gilligan</li>
  <li>Webbtc by Marius Hanne</li>
</ul>

<p><strong>Warning: this is beta software, and is not suitable for production use.  It is being made available for testing purposes only.  It doesn’t support proxying or stream isolation.  In the examples on this page, we explicitly pass command-line arguments telling the client that this is okay.  Leaving off those arguments will result in an error for safety reasons.</strong></p>

<h2 id="installation">Installation</h2>

<p>You can download ConsensusJ-Namecoin at the <a href="/download/betas/#consensusj-namecoin">Beta Downloads</a> page.  (If you prefer to build from source, see the next section.)</p>

<h2 id="build-prerequisites">Build prerequisites</h2>

<p>(This is only if you want to build from source.)</p>

<h3 id="gnulinux">GNU/Linux</h3>

<ol>
  <li>Install OpenJDK from your package repositories.  These instructions will be updated later with specific package names.  Development was done with JDK 8; JDK 7 might work but is untested.</li>
  <li>Make sure that the <code class="highlighter-rouge">JAVA_HOME</code> environment variable is set.  On Jeremy’s Debian Jessie VM, he had to manually set it to <code class="highlighter-rouge">/usr/lib/jvm/java-8-openjdk-amd64</code>.</li>
  <li>Install Maven from your package repositories.  These instructions will be updated later with specific package names.</li>
</ol>

<h3 id="windows">Windows</h3>

<ol>
  <li>Install JDK.  Note that Oracle’s download site doesn’t support TLS.  If you enjoy being MITM-attacked and installing malware, you can <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">download it here (non-TLS link)</a>.</li>
  <li>Make sure that the <code class="highlighter-rouge">JAVA_HOME</code> environment variable is set.  On Jeremy’s Windows 10 VM, he had to manually set it to <code class="highlighter-rouge">C:\Program Files\Java\jdk1.8.0_101</code>.</li>
  <li>Install Maven.  Note that Maven’s official download site uses non-TLS downloads (insecure), MD5 checksums (insecure), and 1024-bit DSA signing keys (insecure).  If you enjoy being MITM-attacked and installing malware, you can use the <a href="https://maven.apache.org/download.cgi">Maven download page</a> and the <a href="https://maven.apache.org/install.html">Maven install page</a>.</li>
</ol>

<p>For those of you who <em>don’t</em> enjoy installing malware, we suggest building from source on GNU/Linux and copying the binary to Windows.</p>

<h3 id="os-x">OS X</h3>

<p>No idea.  If anyone can contribute instructions for OS X, let us know.</p>

<h2 id="build-instructions">Build instructions</h2>

<p>(This is only if you want to build from source.)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/dogecoin/libdohj.git
cd libdohj
mvn clean install
cd namecoin
mvn clean install
cd ../..
git clone https://github.com/JeremyRand/consensusj.git
cd consensusj
git checkout consensusj-namecoin-0.3.2.1
./gradlew clean :cj-nmc-daemon:assemble
</code></pre></div></div>

<p>The binary will be created at <code class="highlighter-rouge">cj-nmc-daemon/build/libs/namecoinj-daemon-0.3.2-SNAPSHOT.jar</code>.</p>

<h2 id="running-it">Running it</h2>

<p><strong>All API elements that are not directly taken from Namecoin Core (including all command-line arguments and all URL formats and JSON structures for the upstream REST API) are not guaranteed to have a stable API; they might be renamed, modified, or removed in the future.</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java -jar ./namecoinj-daemon-0.3.2-SNAPSHOT.jar --connection.proxyenabled=false --connection.streamisolation=false
</code></pre></div></div>

<p>The blockchain takes around 5 minutes to download.  Once it is fully synchronized, the RPC server will automatically start; it listens on port 8080.</p>

<p>You can also customize the behavior of the server with some command line options:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--server.port=&lt;port&gt; (default: 8080)
</code></pre></div></div>

<p>Change what port the RPC server listens on.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--namelookup.latest.algo=&lt;algo&gt; (default: restmerkleapi)
</code></pre></div></div>

<p>Change how <code class="highlighter-rouge">name_show</code> lookups are performed.  The following algorithms are available:</p>

<ul>
  <li><code class="highlighter-rouge">restheightapi</code>: Looks up the height of the latest <code class="highlighter-rouge">name_anyupdate</code> operation for the name that has at least 12 confirmations by using a REST API (default URL is <code class="highlighter-rouge">https://namecoin.webbtc.com/name/heights/&lt;name&gt;.json?raw</code>), and retrieves that block over the P2P network.  This is usually fast, but if the name is part of a very large block, it can take a couple of seconds.  It reveals to the REST API which name is being looked up, and it reveals to a P2P peer what the height of that name is.  The REST API can hide recent <code class="highlighter-rouge">name_anyupdate</code> operations without being detected.</li>
  <li><code class="highlighter-rouge">restmerkleapi</code>: Looks up a Merkle proof for the latest <code class="highlighter-rouge">name_anyupdate</code> operation for the name that has at least 12 confirmations by using a REST API (default URL is <code class="highlighter-rouge">https://namecoin.webbtc.com/name/&lt;name&gt;.json?history&amp;with_height&amp;with_rawtx&amp;with_mrkl_branch&amp;with_tx_idx&amp;raw</code>).  This is slower than <code class="highlighter-rouge">restheightapi</code> for most names, but it’s faster than <code class="highlighter-rouge">restheightapi</code> if the name is in a very large block.  It reveals to the REST API which name is being looked up; it doesn’t reveal anything to the P2P network.  The REST API can hide recent <code class="highlighter-rouge">name_anyupdate</code> operations without being detected.</li>
  <li><code class="highlighter-rouge">restmerkleapisingle</code>: <strong>Unreliable in the current version.</strong> Similar to <code class="highlighter-rouge">restmerkleapi</code>, but increases lookup speed by asking the REST API to only generate a Merkle proof for the most recent <code class="highlighter-rouge">name_anyupdate</code> operation for the name (default URL is <code class="highlighter-rouge">https://namecoin.webbtc.com/name/&lt;name&gt;.json?with_height&amp;with_rawtx&amp;with_mrkl_branch&amp;with_tx_idx&amp;raw</code>).  Faster than <code class="highlighter-rouge">restmerkleapi</code>, but will return an error if the name’s most recent update has between 1 and 11 confirmations (inclusive).  The REST API can hide recent <code class="highlighter-rouge">name_anyupdate</code> operations without being detected.</li>
  <li><code class="highlighter-rouge">leveldbtxcache</code>: Maintains a cache of all unexpired <code class="highlighter-rouge">name_anyupdate</code> operations, obtained by downloading full blocks (instead of just headers) for all blocks that are newer than 366 days old.  Much, much faster lookups than the REST-API-based algos, and lookups don’t generate any network traffic (so lookup operations are as private as Namecoin Core).  Initial syncup will take somewhat longer, and approximately 10 MB of extra storage will be used for the name database.  It is not feasible for <code class="highlighter-rouge">name_anyupdate</code> operations to be hidden without detection, because full blocks are downloaded.  There are known hypothetical attacks possible involving reorganizations deeper than 12 blocks; see the libdohj source code comments for details.</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--namelookup.latest.resturlprefix=&lt;prefix&gt;
--namelookup.latest.resturlsuffix=&lt;suffix&gt;
</code></pre></div></div>

<p>Change what REST API URL is constructed; default depends on the value of <code class="highlighter-rouge">--namelookup.latest.algo</code>.  The URL is constructed by concatenating the prefix, the name, and the suffix.</p>

<h2 id="using-it">Using it</h2>

<h3 id="namecoin-cli">namecoin-cli</h3>

<p><strong>All API elements that are not directly taken from Namecoin Core (including the <code class="highlighter-rouge">valueParsed</code> field and <code class="highlighter-rouge">name_show_at_height</code> method) are not guaranteed to have a stable API; they might be renamed, modified, or removed in the future.</strong></p>

<p>You can use the namecoin-cli tool that comes with Namecoin Core to look up names.  Make sure that you’re using the correct port.  Any username and password are okay.</p>

<p>The following RPC commands are supported:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name_show &lt;name&gt;
</code></pre></div></div>

<p>Similar to <code class="highlighter-rouge">name_show</code> provided by Namecoin Core.  Does not show a result for expired names.  Uses the algorithm specified by <code class="highlighter-rouge">--namelookup.latest.algo</code>.  As of this writing, the <code class="highlighter-rouge">vout</code> and <code class="highlighter-rouge">expired</code> fields normally provided by Namecoin Core are not supported (they are always null).  If the <code class="highlighter-rouge">value</code> field is valid as a JSON object, it will be parsed and made available as a JSON object in the <code class="highlighter-rouge">valueParsed</code> field.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name_show_at_height &lt;name&gt; &lt;height&gt;
</code></pre></div></div>

<p>Similar to <code class="highlighter-rouge">name_show</code>, but displays the <code class="highlighter-rouge">name_anyupdate</code> operation from the given block height, even if it isn’t the latest <code class="highlighter-rouge">name_anyupdate</code> operation for that name.  Does not show a result for expired operations.  Does not show a result if the specified block doesn’t contain a <code class="highlighter-rouge">name_anyupdate</code> operation for the specified name.  The algorithm always retrieves the block over the P2P network.  Usually faster than <code class="highlighter-rouge">name_show</code>, unless <code class="highlighter-rouge">--namelookup.latest.algo=leveldbtxcache</code> is set.  It reveals to a P2P peer which block height is being looked up; it doesn’t reveal anything to a REST API.</p>

<p>Example usage:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./namecoin-cli -rpcport=8080 -rpcuser=user -rpcpassword=pass name_show d/domob
</code></pre></div></div>

<h3 id="curl">curl</h3>

<p>If you don’t have namecoin-cli, any JSON-RPC client should work.  For example, you can use curl:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl --user user:pass --data-binary '{"jsonrpc":"1.0","id":"curltext","method":"name_show","params":["d/domob"]}' -H 'content-type:text/plain;' http://127.0.0.1:8080
</code></pre></div></div>

<h3 id="ncdns">ncdns</h3>

<p>ncdns should work as long as it’s set to the correct port.  For example, you might set the following line in <code class="highlighter-rouge">ncdns.conf</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>namecoinrpcaddress="127.0.0.1:8080"
</code></pre></div></div>

<p>However, note that <code class="highlighter-rouge">--namelookup.latest.algo=leveldbtxcache</code> will be more reliable on many setups than the other algorithms, because of DNS timeouts.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

        <div class="container-fluid" id="social">
            <ul class="list-inline">
                <li><a href="https://github.com/namecoin"><i class="fa fa-github fa-2x" title="GitHub">GitHub</i></a></li>
                <li><a href="https://twitter.com/Namecoin"><i class="fa fa-twitter fa-2x" title="Twitter">Twitter</i></a></li>
                <li><a href="https://www.reddit.com/r/namecoin"><i class="fa fa-reddit-alien fa-2x" title="Reddit">Reddit</i></a></li>
                <li><a href="https://forum.namecoin.org/"><i class="fa fa-comments fa-2x" title="Forum">Forum</i></a></li>
            </ul>
        </div>

        <div class="container-fluid" id="page-source">
            <a href="https://github.com/namecoin/namecoin.org/blob/master/docs/consensusj-namecoin/index.md"><i>Submit corrections or improvements to this page</i></a>
        </div>

        <div class="container-fluid" id="page-alternate">
            <ul class="list-inline">
                <li>This page is available via:</li>
                <li><a href="https://www.namecoin.org/docs/consensusj-namecoin/">DNS (namecoin.org)</a></li>
                <li><a href="https://namecoin.bit/docs/consensusj-namecoin/">Namecoin (namecoin.bit)</a></li>
            </ul>
        </div>

        <div class="container-fluid" id="funders">
            <p>Thanks to our funders:</p>
            
            <ul class="list-inline">
                
                    <li class="funder"><a href='https://nlnet.nl/internethardening/'>NLnet Foundation (Internet Hardening Fund)</a></li>
                
                    <li class="funder">Cyphrs</li>
                
                    <li class="funder">Netherlands Ministry of Economic Affairs (via Internet Hardening Fund)</li>
                
                    <li class="funder"><a href='https://autonomousworlds.com/'>Autonomous Worlds Ltd (Xaya)</a></li>
                
                    <li class="funder"><a href='https://www.f2pool.com/'>F2Pool</a></li>
                
            </ul>
        </div>

        <script src="/js/jquery-2.2.4.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/script.js"></script>
        <script src="/js/remove-nojs.js"></script>
        
</footer>


  </body>

</html>
