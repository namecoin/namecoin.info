<!DOCTYPE html>
<html class="nojs">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>TLS for Firefox on GNU/Linux</title>
    <!--<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">-->

    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <link href="/css/style.css" rel="stylesheet">
    
    <link rel="canonical" href="https://www.namecoin.org/docs/tls-client/firefox/gnu-linux/">
    <link rel="alternate" type="application/rss+xml" title="Namecoin News" href="/feed.rss"/>

    <link rel="icon" href='/images/namecoin-coin_100px.png' sizes="100x100" type="image/png">
    <link rel="icon" href='/images/namecoin-coin_200px.png' sizes="200x200" type="image/png">
    <link rel="icon" href='/images/namecoin-coin.svg' sizes="any" type="image/svg+xml">
</head>


  <body>

    <header class="site-header">

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href='/'><img src='/images/logo.png' alt="Namecoin" /></a>
                </div>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse" tabindex="">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-collapse collapse" id="navbar-collapse">
                <ul class="nav navbar-nav navbar-left">
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Get Started</a>
                        <ul class="dropdown-menu">
                            <li><a href='/download/'>Download</a></li>
                            <li><a href='/get-started/name-wallets/'>Name Wallets</a></li>
                            <li><a href='/get-started/get-namecoins/'>Get Namecoins</a></li>
                            <li><a href='/docs/name-owners/'>Docs for Domain Owners</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Dot-Bit</a>
                        <ul class="dropdown-menu">
                            <li><a href='/dot-bit/'>Home</a></li>
                            <li><a href='/dot-bit/browsing-instructions/'>Browsing Instructions</a></li>
                            <li><a href='/dot-bit/security-model/'>Security Model</a></li>
                        </ul>
                    </li>
                    <li><a href='/docs/faq/'>FAQ</a></li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Resources</a>
                        <ul class="dropdown-menu">
                            <li><a href='/resources/chat/'>Matrix/IRC Chat</a></li>
                            <li><a href="https://forum.namecoin.org">Forum&#10138;</a></li>
                            <li><a href='/resources/presentations/'>Presentations</a></li>
                            <li><a href='/explorers/'>Explorers</a></li>
                            <li><a href='/resources/whitepaper/'>Whitepaper</a></li>
                            <li><a href="https://github.com/namecoin/meta/blob/master/roadmap.md">Roadmap&#10138;</a></li>
                        </ul>
                    </li>
                    <li><a href='/team/'>Team</a></li>
                    <li><a href='/news/'>News</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href='/contribute/'>Contribute</a></li>
                </ul>
                </div>
            </div>
        </nav>

</header>

<div id="fancy-graphic"><div class="container-fluid"><p id="tagline">
<noscript>

Decentralized<br /><strong>secure</strong> names.
</noscript>

    <span class="candidate-tagline" hidden>
        <strong>In information</strong><br />we <strong>trust</strong>.
    </span>

    <span class="candidate-tagline" hidden>
        A <strong>trust anchor</strong><br />for the Internet.
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Against<br />censorship.</strong>
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Supporting<br />free speech.</strong>
    </span>

    <span class="candidate-tagline" hidden>
        Decentralized<br /><strong>secure</strong> names.
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Decentralize</strong><br>all the things!
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Freedom</strong><br>of information.
    </span>

</p></div></div>


    <div id="content">
      <div class="container-fluid">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">TLS for Firefox on GNU/Linux</h1>
  </header>

  <article class="post-content">
    
<h2 id="tls-positive-overrides">TLS Positive Overrides</h2>

<p>Firefox for GNU/Linux can be used with Namecoin for TLS positive overrides; this allows certificates for <code class="highlighter-rouge">.bit</code> domains that match the blockchain to be used without errors.  Instructions:</p>

<ol>
  <li>Find your Firefox profile folder; it will usually be a subfolder of <code class="highlighter-rouge">$HOME/.mozilla/firefox</code>.  For example, <code class="highlighter-rouge">$HOME/.mozilla/firefox/r3a8ono6.default</code>.</li>
  <li>Make sure that your Firefox profile folder is readable and writeable by the user who is running ncdns.</li>
  <li>
    <p>Add the following to <code class="highlighter-rouge">ncdns.conf</code>, substituting your Firefox profile folder for <code class="highlighter-rouge">$PROFILEDIR</code>:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[tlsoverridefirefox]
sync=true
profiledir="$PROFILEDIR"
</code></pre></div>    </div>
  </li>
  <li>Restart ncdns.</li>
</ol>

<p>TLS positive overrides will only be synchronized to Firefox while Firefox is not running; this means that, every so often, you should close Firefox for a few minutes and then re-open it.</p>

<p>You can now visit in Firefox a <code class="highlighter-rouge">.bit</code> website that supports TLS, e.g. <a href="https://nf.bit/">the Namecoin forum’s <code class="highlighter-rouge">.bit</code> domain</a>.  The website should load in Firefox without errors.</p>

<h2 id="tls-negative-overrides">TLS Negative Overrides</h2>

<p>Firefox for GNU/Linux can be used with Namecoin for TLS negative overrides; this prevents malicious or compromised public CA’s from issuing certificates for <code class="highlighter-rouge">.bit</code> domains.  Instructions:</p>

<p><strong>Important warning for users of TLS intercepting proxies: these instructions will probably cause your intercepting proxy to produce an HPKP error for HTTPS websites that use HPKP.  Right now, Namecoin TLS negative overrides for Firefox are not compatible with TLS intercepting proxies that try to intercept HPKP-enabled websites.  If you haven’t deliberately installed a TLS intercepting proxy, or if you don’t know what a TLS intercepting proxy is, you can probably ignore this warning.</strong></p>

<p><strong>Note: Installing Namecoin TLS negative overrides for Firefox might cause previously-unnoticed attacks against you, e.g. from malicious surveillance infrastructure, to produce visible errors (even if those attacks are trying to intercept non-Namecoin connections).</strong></p>

<ol>
  <li>Go to <code class="highlighter-rouge">about:config</code> in Firefox.</li>
  <li>Search for <code class="highlighter-rouge">security.cert_pinning.enforcement_level</code>.</li>
  <li>Double-click the <code class="highlighter-rouge">security.cert_pinning.enforcement_level</code> preference.</li>
  <li>Enter <code class="highlighter-rouge">2</code> and click OK.</li>
  <li>Search for <code class="highlighter-rouge">security.cert_pinning.process_headers_from_non_builtin_roots</code>.</li>
  <li>Double-click the <code class="highlighter-rouge">security.cert_pinning.process_headers_from_non_builtin_roots</code> preference until the <code class="highlighter-rouge">Value</code> column says <code class="highlighter-rouge">true</code>.</li>
  <li>Close the <code class="highlighter-rouge">about:config</code> tab in Firefox.</li>
  <li>Restart Firefox.</li>
  <li>Create a temporary directory; make sure that it only is readable/writeable by a user whom you trust with access to the Firefox certificate database.  Note its path; make sure you use forward-slashes instead of backslashes, and leave off the trailing slash.</li>
  <li>Find your NSS directory; it will usually be a subdirectory of <code class="highlighter-rouge">$HOME/.mozilla/firefox</code>.  For example, <code class="highlighter-rouge">$HOME/.mozilla/firefox/r3a8ono6.default</code>.  Make sure you use forward-slashes instead of backslashes, and leave off the trailing slash.</li>
  <li>
    <p>Run the following, substituting the temporary directory and NSS directory for <code class="highlighter-rouge">$TEMP_DIR</code> and <code class="highlighter-rouge">$NSS_DIR</code>:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./tlsrestrict_nss_tool --tlsrestrict.nss-temp-db-dir="$TEMP_DIR" --tlsrestrict.nss-dest-db-dir="$NSS_DIR"
</code></pre></div>    </div>
  </li>
  <li>Wait a few minutes for <code class="highlighter-rouge">tlsrestrict_nss_tool</code> to finish running.</li>
</ol>

<p>You’ll need to rerun the above <code class="highlighter-rouge">tlsrestrict_nss_tool</code> command whenever the built-in certificate list is updated.  You won’t need to redo the <code class="highlighter-rouge">about:config</code> steps, though.</p>

<p>If you’ve manually imported any non-built-in TLS trust anchors to Firefox, and you want to restrict them from intercepting <code class="highlighter-rouge">.bit</code> traffic, you should do the following for each such trust anchor:</p>

<ol>
  <li>Get a DER-encoded certificate of the trust anchor.</li>
  <li>
    <p>Run the following, substituing the path to your trust anchor certificate for <code class="highlighter-rouge">$CERT_PATH</code>:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./cross_sign_name_constraint_tool --cert.input-root-ca-path="$CERT_PATH"
</code></pre></div>    </div>
  </li>
  <li>3 new certificates will be created: <code class="highlighter-rouge">root.crt</code>, <code class="highlighter-rouge">intermediate.crt</code>, and <code class="highlighter-rouge">cross-signed.crt</code>.</li>
  <li>Delete the existing trust anchor from Firefox.</li>
  <li>Import <code class="highlighter-rouge">root.crt</code> into Firefox; mark it as a trusted TLS root CA.</li>
  <li>Import <code class="highlighter-rouge">intermediate.crt</code> and <code class="highlighter-rouge">cross-signed.crt</code> into Firefox; do not mark them as trusted.</li>
</ol>

<p>If you decide later that you want to remove the negative overrides from Firefox, follow these instructions:</p>

<ol>
  <li>
    <p>Run the following:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./tlsrestrict_nss_tool --tlsrestrict.nss-temp-db-dir="$TEMP_DIR" --tlsrestrict.nss-dest-db-dir="$NSS_DIR" --tlsrestrict.undo
</code></pre></div>    </div>
  </li>
  <li>Wait a few minutes for <code class="highlighter-rouge">tlsrestrict_nss_tool</code> to finish running.</li>
  <li>If you want to restore compatibility with TLS intercepting proxies, follow these steps.  If you don’t want to use a TLS intercepting proxy, or if you don’t know what a TLS intercepting proxy is, you probably don’t need to do this.
    <ol>
      <li>Go to <code class="highlighter-rouge">about:config</code> in Firefox.</li>
      <li>Search for <code class="highlighter-rouge">security.cert_pinning.enforcement_level</code>.</li>
      <li>Right-click the <code class="highlighter-rouge">security.cert_pinning.enforcement_level</code> preference.</li>
      <li>Click <code class="highlighter-rouge">Reset</code>.</li>
      <li>Search for <code class="highlighter-rouge">security.cert_pinning.process_headers_from_non_builtin_roots</code>.</li>
      <li>Right-click the <code class="highlighter-rouge">security.cert_pinning.process_headers_from_non_builtin_roots</code> preference.</li>
      <li>Click <code class="highlighter-rouge">Reset</code>.</li>
      <li>Close the <code class="highlighter-rouge">about:config</code> tab in Firefox.</li>
      <li>Restart Firefox.</li>
    </ol>
  </li>
</ol>

<h3 id="screenshot">Screenshot</h3>

<p>If a <code class="highlighter-rouge">.bit</code> HTTPS website uses a CA-signed certificate that doesn’t match the Namecoin blockchain, an error like this will be displayed:</p>

<p><img src="/images/screenshots/tls/tls-reject-firefox-linux-2018-08-01.png" alt="start.fedoraproject.org uses an invalid security certificate.  The certificate is not trusted because the issuer certificate is unknown.  The server might not be sending the appropriate intermediate certificates.  An additional root certificate may need to be imported." /></p>

<h2 id="strict-transport-security">Strict Transport Security</h2>

<p>Firefox for GNU/Linux can be used with Namecoin for Strict Transport Security; this improves security against sslstrip-style attacks by forcing HTTPS to be used for <code class="highlighter-rouge">.bit</code> domains that support HTTPS.  Instructions:</p>

<ol>
  <li>Install <a href="/docs/ncdns/">ncdns</a>.</li>
  <li>Download and extract the DNSSEC-HSTS Native Component from the <a href="/download/betas/#dnssec-hsts">Beta Downloads</a> page.</li>
  <li>
    <p>Install the DNSSEC-HSTS Native Component like this:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo cp ./org.namecoin.dnssec_hsts.json /usr/lib64/mozilla/native-messaging-hosts/
sudo cp ./dnssec_hsts /usr/bin/
</code></pre></div>    </div>
  </li>
  <li>Download the DNSSEC-HSTS WebExtensions Component from the <a href="/download/betas/#dnssec-hsts">Beta Downloads</a> page.</li>
  <li>
    <p>Install the DNSSEC-HSTS WebExtensions Component like this:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip -d ./dnssec-hsts ./dnssec-hsts-*.xpi
sudo rm -rf /usr/share/webext/dnssec-hsts/
sudo cp -a ./dnssec-hsts /usr/share/webext/dnssec-hsts
sudo ln -s -T /usr/share/webext/dnssec-hsts "/usr/share/mozilla/extensions/{ec8030f7-c20a-464f-9b0e-13a3a9e97384}/dnssec-hsts"
</code></pre></div>    </div>
  </li>
</ol>

<p>You may need to restart Firefox.  You may need to enable DNSSEC-HSTS in the Firefox Addons dialog.</p>

<p><code class="highlighter-rouge">.bit</code> domains that support HTTPS will now automatically redirect from HTTP to HTTPS in Firefox.</p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

        <div class="container-fluid" id="social">
            <ul class="list-inline">
                <li><a href="https://github.com/namecoin"><i class="fa fa-github fa-2x" title="GitHub">GitHub</i></a></li>
                <li><a href="https://twitter.com/Namecoin"><i class="fa fa-twitter fa-2x" title="Twitter">Twitter</i></a></li>
                <li><a href="https://www.reddit.com/r/namecoin"><i class="fa fa-reddit-alien fa-2x" title="Reddit">Reddit</i></a></li>
                <li><a href="https://forum.namecoin.org/"><i class="fa fa-comments fa-2x" title="Forum">Forum</i></a></li>
            </ul>
        </div>

        <div class="container-fluid" id="page-source">
            <a href="https://github.com/namecoin/namecoin.org/blob/master/docs/tls-client/firefox/gnu-linux/index.md"><i>Submit corrections or improvements to this page</i></a>
        </div>

        <div class="container-fluid" id="page-alternate">
            <ul class="list-inline">
                <li>This page is available via:</li>
                <li><a href="https://www.namecoin.org/docs/tls-client/firefox/gnu-linux/">DNS (namecoin.org)</a></li>
                <li><a href="https://namecoin.bit/docs/tls-client/firefox/gnu-linux/">Namecoin (namecoin.bit)</a></li>
            </ul>
        </div>

        <div class="container-fluid" id="funders">
            <p>Thanks to our funders:</p>
            
            <ul class="list-inline">
                
                    <li class="funder"><a href='https://cyberia.club/'>Cyberia Computer Club</a></li>
                
                    <li class="funder">Cyphrs</li>
                
                    <li class="funder"><a href='https://nlnet.nl/internethardening/'>NLnet Foundation (Internet Hardening Fund)</a></li>
                
                    <li class="funder"><a href='https://autonomousworlds.com/'>Autonomous Worlds Ltd (Xaya)</a></li>
                
                    <li class="funder"><a href='https://www.f2pool.com/'>F2Pool</a></li>
                
                    <li class="funder">Netherlands Ministry of Economic Affairs (via Internet Hardening Fund)</li>
                
                    <li class="funder"><a href='https://www.cyphermarket.com/'>Cypher Market</a></li>
                
            </ul>
        </div>

        <script src="/js/jquery-2.2.4.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/script.js"></script>
        <script src="/js/remove-nojs.js"></script>
        
</footer>


  </body>

</html>
