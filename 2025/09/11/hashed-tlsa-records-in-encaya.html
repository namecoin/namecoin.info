<!DOCTYPE html>
<html class="nojs">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Hashed TLSA Records in Encaya</title>
    <!--<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">-->

    <link href="/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/css/bootstrap.min.css" rel="stylesheet">

    <link href="/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/css/style.css" rel="stylesheet">
    
    <link rel="canonical" href="http://127.0.0.1:43110/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/2025/09/11/hashed-tlsa-records-in-encaya.html">
    <link rel="alternate" type="application/rss+xml" title="Namecoin News" href="/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/feed.rss"/>

    <link rel="icon" href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/images/namecoin-coin_100px.png' sizes="100x100" type="image/png">
    <link rel="icon" href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/images/namecoin-coin_200px.png' sizes="200x200" type="image/png">
    <link rel="icon" href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/images/namecoin-coin.svg' sizes="any" type="image/svg+xml">

    <script src="/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/js/jquery-2.2.4.min.js"></script>
    <script src="/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/js/bootstrap.min.js"></script>
    <script src="/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/js/remove-nojs.js"></script>
</head>


  <body>

    <header class="site-header">

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/'><img src='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/images/logo.png' alt="Namecoin" /></a>
                </div>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse" tabindex="">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-collapse collapse" id="navbar-collapse">
                <ul class="nav navbar-nav navbar-left">
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Get Started</a>
                        <ul class="dropdown-menu">
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/download/'>Download</a></li>
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/get-started/name-wallets/'>Name Wallets</a></li>
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/get-started/get-namecoins/'>Get Namecoins</a></li>
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/docs/name-owners/'>Docs for Domain Owners</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Dot-Bit</a>
                        <ul class="dropdown-menu">
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/dot-bit/'>Home</a></li>
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/dot-bit/browsing-instructions/'>Browsing Instructions</a></li>
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/dot-bit/security-model/'>Security Model</a></li>
                        </ul>
                    </li>
                    <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/docs/faq/'>FAQ</a></li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Resources</a>
                        <ul class="dropdown-menu">
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/resources/chat/'>Matrix/IRC Chat</a></li>
                            <li><a href="https://forum.namecoin.org">Forum&#10138;</a></li>
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/resources/presentations/'>Presentations</a></li>
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/explorers/'>Explorers</a></li>
                            <li><a href='https://metrics.namecoin.org/'>Metrics</a></li>
                            <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/resources/whitepaper/'>Whitepaper</a></li>
                            <li><a href="https://github.com/namecoin/meta/blob/master/roadmap.md">Roadmap&#10138;</a></li>
                        </ul>
                    </li>
                    <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/team/'>Team</a></li>
                    <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/news/'>News</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/contribute/'>Contribute</a></li>
                </ul>
                </div>
            </div>
        </nav>

</header>

<div id="fancy-graphic"><div class="container-fluid"><p id="tagline">
<span id="default-tagline">

<strong>Freedom</strong><br>of information.
</span>

    <span class="candidate-tagline" hidden>
        <strong>In information</strong><br />we <strong>trust</strong>.
    </span>

    <span class="candidate-tagline" hidden>
        A <strong>trust anchor</strong><br />for the Internet.
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Against<br />censorship.</strong>
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Supporting<br />free speech.</strong>
    </span>

    <span class="candidate-tagline" hidden>
        Decentralized<br /><strong>secure</strong> names.
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Decentralize</strong><br>all the things!
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Freedom</strong><br>of information.
    </span>

</p></div></div>


    <div id="content">
      <div class="container-fluid">
        











<div class="post">

<header class="post-header">
<h1 class="post-title">Hashed TLSA Records in Encaya</h1>
<p class="post-meta">Sep 11, 2025 • Jeremy Rand <i class="fa fa-tag"></i></p>
</header>

<article class="post-content">
<p>As long-time readers will be aware, probably the biggest innovation of Namecoin’s TLS functionality is that it uses a special form of TLS certificates that happens to work well in mainstream web browsers, via the interoperability magic of AIA and PKCS#11. This avoids having to patch web browsers or intercept TLS connections (either of which would introduce nontrivial security liabilities).</p>

<p>One of the consequences of this benefit has been that Namecoin domains must embed an ECDSA public key on-chain. ECDSA public keys, alas, are somewhat big. We worked around this, sort of, by using compressed public keys on-chain, and decompressing them on-the-fly before passing them to web browsers via AIA. This was still suboptimal for a few reasons:</p>

<ol>
  <li>Compressed ECDSA public keys are still kind of big. Much bigger than a SHA-256 hash.</li>
  <li>Compressed ECDSA public keys aren’t supported by the Go standard library, so we had to maintain a fork of the standard library.</li>
  <li>Whatever escape hatch we get from using compressed ECDSA public keys won’t help us when TLS eventually moves to PQ signatures. (More on this in a future post.)</li>
</ol>

<p>So, why did we need full public keys in the blockchain (as opposed to a public key hash) anyway? The constraints are as follows:</p>

<ol>
  <li>Encaya needs to synthesize a CA certificate when the browser asks for it.</li>
  <li>This synthesized CA certificate needs to contain the public key that the domain owner picked.</li>
  <li>The browser will <em>not</em> provide any public keys that the TLS server presented in the certificate chain.</li>
  <li><strong>Therefore</strong>, Encaya needs to get the public key from the blockchain, since there’s no other way to get it given the API constraints. QED. <em>Right…?</em></li>
</ol>

<p>Um, about that last assumption. Is there really no other way to get the public key given the API constraints?</p>

<p>Moreover, how does Encaya even know what domain name to look up in the blockchain? Could we get the public key that way?</p>

<p>Hmm…</p>

<p>Encaya gets the domain name from an AIA request (for Chromium-like browsers) or from a PKCS#11 request (for Firefox-like browsers). Why do these requests contain the domain name? Uh. Because we put the domain name there?</p>

<p>The AIA request contains whatever data is in the AIA Issuer URL field of a certificate sent by the TLS server. The PKCS#11 request contains whatever data is in the Issuer Distinguished Name (DN) field of that certificate. There’s no requirement that either of those fields contain the domain name. The DN does <em>sometimes</em> contain a domain name in the Common Name field, but that’s normally only a thing for end-entity certificates, not CA certificates. The AIA Issuer URL field definitely doesn’t normally have anything like that under any circumstances. In both fields, we <em>deliberately</em> put the domain name there so that Encaya would see it.</p>

<p>You probably see where this is going. Could we stuff a public key into the AIA Issuer URL and the Subject DN? It’d look pretty weird, but if you’re averse to looking weird, you’re probably not a hacker.</p>

<p>So here’s the new workflow:</p>

<ol>
  <li>The AIA Issuer URL field of the CA certificate sent by the TLS server adds a new GET query parameter, containing a base64-encoded public key.</li>
  <li>The Subject DN field of that CA certificate’s parent CA adds a base64-encoded public key in the Subject Serial Number subfield.</li>
  <li>The Issuer DN field of the CA certificate matches the Subject DN of its parent, thus also including an Issuer Serial Number with a base64-encoded public  key in it.</li>
  <li>When Chromium sees this certificate chain, it sends an AIA request to Encaya that includes the public key as part of the AIA Issuer URL.</li>
  <li>When Firefox sees this certificate chain, it sends a PKCS#11 request to ncp11 that includes the public key as part of the Subject DN or Issuer DN.</li>
  <li>Encaya can then compare this public key to the hashed TLSA record in the blockchain. It if matches, Encaya uses the public key in its synthesized CA.</li>
  <li>Chromium and Firefox don’t know that anything funky has happened. Sure, there’s an intermediate CA with a really long AIA Issuer URL and Issuer Serial Number. But Chromium and Firefox don’t care about that.</li>
  <li>On-chain savings achieved. <em>We win!</em></li>
</ol>

<p>I’ve implemented the above in Encaya, ncp11, and generate_nmc_cert. What do the savings look like?</p>

<ul>
  <li>Before: 90 bytes of JSON per TLSA record</li>
  <li>After: 54 bytes of JSON per TLSA record</li>
</ul>

<p>The TLS handshake, of course, contains a bit more data, but TLS handshake bytes are cheap compared to on-chain bytes.</p>

<p>Once this feature gets into a release, we will contact Namecoin HTTPS website operators in the wild (where feasible) to nudge them to upgrade their setup. Support for the previous certificate format will probably be dropped soon, because the maintenance burden of a standard Go crypto library fork is not a good use of my time.</p>

<p>This work was funded by Power Up Privacy.</p>


</article>

<footer>
<p><em>If you liked this article, maybe consider <a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/donate/'>donating</a>, <a href="https://namecoin.creator-spring.com/">buying a t-shirt</a>, or <a href='/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/contribute/'>contributing in some other way</a>. Funding from average users like you helps keep us independent. Thanks for your support!</em></p>
</footer>

</div>

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































      </div>
    </div>

    <footer class="site-footer">

        <div class="container-fluid" id="social">
            <ul class="list-inline">
                <li><a href="https://github.com/namecoin"><i class="fa fa-github fa-2x" title="GitHub">GitHub</i></a></li>
                <li><a href="https://twitter.com/Namecoin"><i class="fa fa-twitter fa-2x" title="Twitter">Twitter</i></a></li>
                <li><a href="https://www.reddit.com/r/Namecoin"><i class="fa fa-reddit-alien fa-2x" title="Reddit">Reddit</i></a></li>
                <li><a href="https://forum.namecoin.org/"><i class="fa fa-comments fa-2x" title="Forum">Forum</i></a></li>
                <li><a href="/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/license.html"><i class="fa fa-2x" title="Copyright">Copyright</i></a></li>
                <li><a href="/1FPSdChfmaAjMMUgoYLxAYHTDS46gnvmUw/team/security/"><i class="fa fa-2x" title="Vulnerability Disclosure">Security</i></a></li>
            </ul>
        </div>

        <div class="container-fluid" id="page-source">
            <a href="https://github.com/namecoin/namecoin.org/blob/master/_posts/2025-09-11-hashed-tlsa-records-in-encaya.md"><i>Submit corrections or improvements to this page</i></a>
        </div>

        <div class="container-fluid" id="page-alternate">
            <ul class="list-inline">
                <li>This page is available via:</li>
                <li><a href="https://www.namecoin.org/2025/09/11/hashed-tlsa-records-in-encaya.html">DNS (namecoin.org)</a></li>
                <li><a href="https://www.rw6nbpjrmcpdxszn3air4bt7t75rpz4cp3c2kbdu72ptua57tzvin4id.onion/2025/09/11/hashed-tlsa-records-in-encaya.html">Onion</a></li>
                <li><a href="http://127.0.0.1:43110/1EZSUprqJQph9JwKg3gAJtiNs899vatZTo/2025/09/11/hashed-tlsa-records-in-encaya.html">ZeroNet</a></li>
                <li><a href="https://namecoin.bit/2025/09/11/hashed-tlsa-records-in-encaya.html">Namecoin (namecoin.bit)</a></li>
            </ul>
        </div>

        <div class="container-fluid" id="funders">
            <p>Thanks to our funders:</p>
            
            <ul class="list-inline">
                
                    <li class="funder"><a href='https://www.outreachy.org/'>Software Freedom Conservancy (Outreachy)</a></li>
                
                    <li class="funder">European Commission Directorate-General for Communications Networks, Content and Technology (via Next Generation Internet: Assure)</li>
                
                    <li class="funder"><a href='https://www.cyphermarket.com/'>Cypher Market</a></li>
                
                    <li class="funder"><a href='https://nlnet.nl/internethardening/'>NLnet Foundation (Internet Hardening Fund)</a></li>
                
                    <li class="funder">Cyphrs</li>
                
                    <li class="funder"><a href='https://www.rijksoverheid.nl/ministeries/ministerie-van-economische-zaken-en-klimaat'>Netherlands Ministry of Economic Affairs and Climate Policy (via Internet Hardening Fund)</a></li>
                
                    <li class="funder"><a href='https://autonomousworlds.com/'>Autonomous Worlds Ltd (Xaya)</a></li>
                
                    <li class="funder"><a href='https://powerupprivacy.com/'>Power Up Privacy</a></li>
                
                    <li class="funder"><a href='https://www.torproject.org/'>Tor Project (via Outreachy)</a></li>
                
                    <li class="funder"><a href='https://nlnet.nl/core/'>NLnet Foundation (Next Generation Internet Zero: Core)</a></li>
                
                    <li class="funder"><a href='https://cyberia.club/'>Cyberia Computer Club (Capsul)</a></li>
                
                    <li class="funder">European Commission Directorate-General for Communications Networks, Content and Technology (via Next Generation Internet Zero: Core)</li>
                
                    <li class="funder"><a href='https://nlnet.nl/assure/'>NLnet Foundation (Next Generation Internet: Assure)</a></li>
                
                    <li class="funder"><a href='https://www.f2pool.com/'>F2Pool</a></li>
                
                    <li class="funder">Handshake</li>
                
                    <li class="funder"><a href='https://nlnet.nl/discovery/'>NLnet Foundation (Next Generation Internet Zero: Search and Discovery)</a></li>
                
                    <li class="funder">European Commission Directorate-General for Communications Networks, Content and Technology (via Next Generation Internet Zero: Search and Discovery)</li>
                
            </ul>
        </div>

        <div class="container-fluid" id="disclaimer">
            <p>Namecoin is produced independently from the Tor® anonymity software and carries no guarantee from The Tor Project about quality, suitability or anything else.</p>
        </div>
</footer>


  </body>

</html>
