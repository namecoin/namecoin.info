<!DOCTYPE html>
<html class="nojs">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ncp11 Now Works in Tor Browser for Windows</title>
    <!--<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">-->

    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <link href="/css/style.css" rel="stylesheet">
    
    <link rel="canonical" href="https://namecoin.bit/2019/06/18/ncp11-now-works-in-tor-browser-for-windows.html">
    <link rel="alternate" type="application/rss+xml" title="Namecoin News" href="/feed.rss"/>

    <link rel="icon" href='/images/namecoin-coin_100px.png' sizes="100x100" type="image/png">
    <link rel="icon" href='/images/namecoin-coin_200px.png' sizes="200x200" type="image/png">
    <link rel="icon" href='/images/namecoin-coin.svg' sizes="any" type="image/svg+xml">

    <script src="/js/jquery-2.2.4.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/remove-nojs.js"></script>
</head>


  <body>

    <header class="site-header">

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href='/'><img src='/images/logo.png' alt="Namecoin" /></a>
                </div>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse" tabindex="">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-collapse collapse" id="navbar-collapse">
                <ul class="nav navbar-nav navbar-left">
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Get Started</a>
                        <ul class="dropdown-menu">
                            <li><a href='/download/'>Download</a></li>
                            <li><a href='/get-started/name-wallets/'>Name Wallets</a></li>
                            <li><a href='/get-started/get-namecoins/'>Get Namecoins</a></li>
                            <li><a href='/docs/name-owners/'>Docs for Domain Owners</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Dot-Bit</a>
                        <ul class="dropdown-menu">
                            <li><a href='/dot-bit/'>Home</a></li>
                            <li><a href='/dot-bit/browsing-instructions/'>Browsing Instructions</a></li>
                            <li><a href='/dot-bit/security-model/'>Security Model</a></li>
                        </ul>
                    </li>
                    <li><a href='/docs/faq/'>FAQ</a></li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" tabindex="">Resources</a>
                        <ul class="dropdown-menu">
                            <li><a href='/resources/chat/'>Matrix/IRC Chat</a></li>
                            <li><a href="https://nf.bit">Forum&#10138;</a></li>
                            <li><a href='/resources/presentations/'>Presentations</a></li>
                            <li><a href='/explorers/'>Explorers</a></li>
                            <li><a href='https://metrics.namecoin.bit/'>Metrics</a></li>
                            <li><a href='/resources/whitepaper/'>Whitepaper</a></li>
                            <li><a href="https://github.com/namecoin/meta/blob/master/roadmap.md">Roadmap&#10138;</a></li>
                        </ul>
                    </li>
                    <li><a href='/team/'>Team</a></li>
                    <li><a href='/news/'>News</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href='/contribute/'>Contribute</a></li>
                </ul>
                </div>
            </div>
        </nav>

</header>

<div id="fancy-graphic"><div class="container-fluid"><p id="tagline">
<span id="default-tagline">

<strong>Decentralize</strong><br>all the things!
</span>

    <span class="candidate-tagline" hidden>
        <strong>In information</strong><br />we <strong>trust</strong>.
    </span>

    <span class="candidate-tagline" hidden>
        A <strong>trust anchor</strong><br />for the Internet.
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Against<br />censorship.</strong>
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Supporting<br />free speech.</strong>
    </span>

    <span class="candidate-tagline" hidden>
        Decentralized<br /><strong>secure</strong> names.
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Decentralize</strong><br>all the things!
    </span>

    <span class="candidate-tagline" hidden>
        <strong>Freedom</strong><br>of information.
    </span>

</p></div></div>


    <div id="content">
      <div class="container-fluid">
        























































































































































































































































































































































<div class="post">

<header class="post-header">
<h1 class="post-title">ncp11 Now Works in Tor Browser for Windows</h1>
<p class="post-meta">Jun 18, 2019 • Jeremy Rand <i class="fa fa-tag"></i></p>
</header>

<article class="post-content">
<p>ncp11 is now working (both positive and negative TLS certificate overrides) in Tor Browser for Windows.  It turned out that the only things keeping it from working properly once it <a href="/2019/06/15/ncp11-now-builds-for-windows.html">built without errors</a> were a couple of GNU/Linux-specific file path assumptions, both of which were quite easy to fix.</p>

<p>Actually testing it was mildly tricky, due to the fact that I was trying to use StemNS (a fork I made of meejah’s TorNS tool) for the DNS resolution in Tor Browser, and it turns out that there was a bug in both upstream TorNS and StemNS that caused the Prop279 implementation to launch with an empty set of environment variables.  In GNU/Linux, this is harmless, but (surprise, surprise) in Windows this causes a variety of horrible effects, chief among which is that cryptographic software will be unable to generate random numbers and thus will crash.  I was going to find that out anyway once the Tor community started messing with StemNS, so probably a good thing that I found it early.  (I wish it hadn’t taken me quite so long to figure out why things were crashing, but alas, that’s life.)  StemNS now has a fix for that bug, and I’ve submitted a fix upstream to TorNS as well.</p>

<p>So, my estimate of what remains before we can release Tor Browser TLS support:</p>

<ol>
  <li>Get the remaining PR’s merged to the relevant repos (in particular, ncdns-repro has a few pending PR’s that are needed for this).</li>
  <li>Tag a release and build/upload binaries.</li>
  <li>Write some documentation (should be easy to adapt from the 35C3 workshop notes).</li>
</ol>

<p>Meanwhile, I also tried ncp11 in Firefox for Windows (same installation method as in Tor Browser), and ran into some severe trouble there.  As far as I can tell, the ncp11 library is failing very early in the boot process: it doesn’t even get as far as running the <code class="highlighter-rouge">init()</code> functions in the Go code.  Firefox gives a relatively useless “library failure” error, which is presumably a different code path from the “library failure” error that I’m getting in Debian when loading ncp11 into Firefox via a totally different installation method from the Tor Browser method.</p>

<p>Inspecting Mozilla’s CKBI library and ncp11 with the <code class="highlighter-rouge">file</code> commmand yielded 2 noticeable differences in file format:</p>

<ol>
  <li>CKBI’s PE metadata is set to use the GUI subsystem, while ncp11 is set to use the console subsystem.</li>
  <li>CKBI isn’t stripped, while ncp11 is stripped.</li>
</ol>

<p>Difference 1 was ruled out by switching ncp11’s PE metadata to use the GUI subsystem; it didn’t help.  Difference 2 is certainly a possible explanation, and I’ll spend some time later checking what happens if ncp11 isn’t built with the <code class="highlighter-rouge">-s</code> linker flag.  That said, I suspect that the best way to figure out what’s going wrong is to patch in some debug output to Firefox and NSS so that I can figure out what code path the “library failure” error is happening in.</p>

<p>However, as curious as I am to see what’s failing in Firefox, it should be noted that ncp11’s current funding from NLnet is contingent on Tor Browser support, not Firefox support, which means that I’m unlikely to spend a lot of time debugging the Firefox failure in the near future (especially since the “TLS for Tor Browser” milestone for NLnet has already gone severely over-budget due to the unexpectedly large amount of R&amp;D needed to produce ncp11).  I’ll probably resume the Firefox debugging after we’ve secured more funding for this effort.</p>

<p>In the meantime, Namecoin TLS support for Tor Browser is likely to be released very soon.  Yay!</p>

<p>This work was funded by NLnet Foundation’s Internet Hardening Fund.</p>

</article>

</div>





































































































































































































































































































































































































































































































































      </div>
    </div>

    <footer class="site-footer">

        <div class="container-fluid" id="social">
            <ul class="list-inline">
                <li><a href="https://github.com/namecoin"><i class="fa fa-github fa-2x" title="GitHub">GitHub</i></a></li>
                <li><a href="https://twitter.com/Namecoin"><i class="fa fa-twitter fa-2x" title="Twitter">Twitter</i></a></li>
                <li><a href="https://www.reddit.com/r/namecoin"><i class="fa fa-reddit-alien fa-2x" title="Reddit">Reddit</i></a></li>
                <li><a href="https://nf.bit/"><i class="fa fa-comments fa-2x" title="Forum">Forum</i></a></li>
                <li><a href="/license.html"><i class="fa fa-2x" title="Copyright">Copyright</i></a></li>
                <li><a href="/team/security/"><i class="fa fa-2x" title="Vulnerability Disclosure">Security</i></a></li>
            </ul>
        </div>

        <div class="container-fluid" id="page-source">
            <a href="https://github.com/namecoin/namecoin.org/blob/master/_posts/2019-06-18-ncp11-now-works-in-tor-browser-for-windows.md"><i>Submit corrections or improvements to this page</i></a>
        </div>

        <div class="container-fluid" id="page-alternate">
            <ul class="list-inline">
                <li>This page is available via:</li>
                <li><a href="https://www.namecoin.org/2019/06/18/ncp11-now-works-in-tor-browser-for-windows.html">DNS (namecoin.org)</a></li>
                <li><a href="https://www.rw6nbpjrmcpdxszn3air4bt7t75rpz4cp3c2kbdu72ptua57tzvin4id.onion/2019/06/18/ncp11-now-works-in-tor-browser-for-windows.html">Onion</a></li>
                <li><a href="http://127.0.0.1:43110/1EZSUprqJQph9JwKg3gAJtiNs899vatZTo/2019/06/18/ncp11-now-works-in-tor-browser-for-windows.html">ZeroNet</a></li>
                <li><a href="https://namecoin.bit/2019/06/18/ncp11-now-works-in-tor-browser-for-windows.html">Namecoin (namecoin.bit)</a></li>
            </ul>
        </div>

        <div class="container-fluid" id="funders">
            <p>Thanks to our funders:</p>
            
            <ul class="list-inline">
                
                    <li class="funder"><a href='https://autonomousworlds.com/'>Autonomous Worlds Ltd (Xaya)</a></li>
                
                    <li class="funder"><a href='https://www.rijksoverheid.nl/ministeries/ministerie-van-economische-zaken-en-klimaat'>Netherlands Ministry of Economic Affairs and Climate Policy (via Internet Hardening Fund)</a></li>
                
                    <li class="funder"><a href='https://www.outreachy.org/'>Software Freedom Conservancy (Outreachy)</a></li>
                
                    <li class="funder"><a href='https://cyberia.club/'>Cyberia Computer Club (Capsul)</a></li>
                
                    <li class="funder"><a href='https://nlnet.nl/internethardening/'>NLnet Foundation (Internet Hardening Fund)</a></li>
                
                    <li class="funder"><a href='https://www.f2pool.com/'>F2Pool</a></li>
                
                    <li class="funder">Cyphrs</li>
                
                    <li class="funder"><a href='https://www.cyphermarket.com/'>Cypher Market</a></li>
                
                    <li class="funder">European Commission Directorate-General for Communications Networks, Content and Technology (via Next Generation Internet Zero: Search and Discovery)</li>
                
                    <li class="funder">Handshake</li>
                
                    <li class="funder"><a href='https://nlnet.nl/discovery/'>NLnet Foundation (Next Generation Internet Zero: Search and Discovery)</a></li>
                
                    <li class="funder"><a href='https://www.torproject.org/'>Tor Project (via Outreachy)</a></li>
                
            </ul>
        </div>

        <div class="container-fluid" id="disclaimer">
            <p>Namecoin is produced independently from the Tor® anonymity software and carries no guarantee from The Tor Project about quality, suitability or anything else.</p>
        </div>
</footer>


  </body>

</html>
